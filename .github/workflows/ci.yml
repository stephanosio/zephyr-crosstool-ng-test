name: CI

on:
  push:
    branches: [ test_master ]
  pull_request:
    branches: [ test_master ]

jobs:
  build:
    name: ${{ matrix.target }} (${{ matrix.host.name }})
    runs-on: ${{ matrix.host.build }}

    strategy:
      fail-fast: false
      matrix:
        host:
        - name: linux-x86_64
          build: ubuntu-18.04
        - name: macos-x86_64
          build: macos-10.15
        - name: windows-x86_64
          build: ubuntu-18.04
        target:
        - aarch64-zephyr-elf

    steps:
    # Check out source code
    - name: Check out source code
      uses: actions/checkout@v2

    # Fetch all history for all tags and branches
    - run: git fetch --prune --unshallow

    # Build toolchain
    - name: Build ${{ matrix.target }} toolchain for ${{ matrix.host.name }}
      run: |
        echo "DUMMY FILE" > ${HOME}/${{ matrix.target }}.tar.gz

    # Upload toolchain
    - name: Upload toolchain
      uses: actions/upload-artifact@v2
      with:
        name: toolchain_${{ matrix.host.name }}_${{ matrix.target }}
        path: ~/${{ matrix.target }}.tar.gz
